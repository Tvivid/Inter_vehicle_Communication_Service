<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메시지 설정</title>
    <style>
        /* 기본 설정 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        /* 배경과 레이아웃 */
        body {
            background-color: #0a0e2b;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 100vh;
            padding-bottom: 20px;
        }

        /* 팝업 박스 */
        .popup {
            background-color: white;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        /* 드래그 바 (위의 작은 선) */
        .drag-bar {
            width: 50px;
            height: 5px;
            background-color: #ccc;
            border-radius: 2.5px;
            margin: 0 auto 20px auto;
        }

        /* 메시지 입력 필드 */
        .message-input {
            display: flex;
            align-items: center;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .message-input img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .message-input input {
            flex-grow: 1;
            border: none;
            background: none;
            font-size: 16px;
            color: #888;
        }

        /* 아이콘 선택 섹션 */
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .icon-grid img {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background-color: #f5f5f5;
        }

        /* 색상 선택 섹션 */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .color-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #f5f5f5;
            cursor: pointer;
        }

        /* 특정 색상들 */
        .color-red {
            background-color: #ff5a5a;
        }

        .color-yellow {
            background-color: #ffcc00;
        }

        .color-green {
            background-color: #69c989;
        }

        .color-blue {
            background-color: #4a90e2;
        }

        .color-pink {
            background-color: #ff99cc;
        }

        .color-lightgreen {
            background-color: #b2e672;
        }

        .color-lightblue {
            background-color: #79c7e3;
        }

        .color-purple {
            background-color: #7d4cac;
        }

        /* 이미지 첨부 버튼 */
        .attach-btn {
            background-color: #1f3c60;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            margin-bottom: 20px;
            cursor: pointer;
        }

        /* 변경하기 버튼 */
        .submit-btn {
            width: 100%;
            padding: 15px;
            background-color: #1f3c60;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
            text-align: center;
            border-radius: 10px;
        }

        .submit-btn:hover {
            background-color: #172d48;
        }
    </style>
</head>

<body>
<!-- 메시지 설정 팝업 -->
<div class="popup">
    <!-- 드래그 바 -->
    <div class="drag-bar"></div>

    <!-- 메시지 입력 필드 -->
    <div class="message-input">
        <img id="selected-icon" th:src="@{'/images/emojis/' + ${customizingSetting.emojiId} + '.png'}" alt="선택된 아이콘">
        <input type="text" id="message"  placeholder="텍스트를 입력하세요.." />
    </div>

    <!-- 아이콘 선택 섹션 -->
    <div class="icon-grid">
        <img src="/images/emojis/1.png" alt="아이콘 1" onclick="selectEmoji(1)">
        <img src="/images/emojis/2.png" alt="아이콘 2" onclick="selectEmoji(2)">
        <img src="/images/emojis/3.png" alt="아이콘 3" onclick="selectEmoji(3)">
        <img src="/images/emojis/4.png" alt="아이콘 4" onclick="selectEmoji(4)">
        <img src="/images/emojis/5.png" alt="아이콘 5" onclick="selectEmoji(5)">
        <img src="/images/emojis/6.png" alt="아이콘 6" onclick="selectEmoji(6)">
        <img src="/images/emojis/7.png" alt="아이콘 7" onclick="selectEmoji(7)">
        <img src="/images/emojis/8.png" alt="아이콘 8" onclick="selectEmoji(8)">
        <img src="/images/emojis/9.png" alt="아이콘 9" onclick="selectEmoji(9)">
        <img src="/images/emojis/10.png" alt="아이콘 10" onclick="selectEmoji(10)">
        <img src="/images/emojis/11.png" alt="아이콘 11" onclick="selectEmoji(11)">
        <img src="/images/emojis/12.png" alt="아이콘 12" onclick="selectEmoji(12)">
        <img src="/images/emojis/13.png" alt="아이콘 13" onclick="selectEmoji(13)">
        <img src="/images/emojis/14.png" alt="아이콘 14" onclick="selectEmoji(14)">
        <img src="/images/emojis/15.png" alt="아이콘 15" onclick="selectEmoji(15)">
        <img src="/images/emojis/16.png" alt="아이콘 16" onclick="selectEmoji(16)">
    </div>

<!--    &lt;!&ndash; 색상 선택 섹션 &ndash;&gt;-->
<!--    <div class="color-grid">-->
<!--        <div class="color-circle color-red" onclick="selectColor('#ff5a5a')"></div>-->
<!--        <div class="color-circle color-yellow" onclick="selectColor('#ffcc00')"></div>-->
<!--        <div class="color-circle color-green" onclick="selectColor('#69c989')"></div>-->
<!--        <div class="color-circle color-blue" onclick="selectColor('#4a90e2')"></div>-->
<!--        <div class="color-circle color-pink" onclick="selectColor('#ff99cc')"></div>-->
<!--        <div class="color-circle color-lightgreen" onclick="selectColor('#b2e672')"></div>-->
<!--        <div class="color-circle color-lightblue" onclick="selectColor('#4a90e2')"></div>-->
<!--        <div class="color-circle color-purple" onclick="selectColor('#7d4cac')"></div>-->
<!--    </div>-->

    <!-- 이미지 첨부 -->
    <input type="file" id="file" />

    <!-- 변경하기 버튼 -->
    <button class="submit-btn" onclick="submitForm()">변경하기</button>
</div>

<script>


    // 주석 형식이 아닌 표현식 사용
    let customizingId = '[[${customizingSetting.customizingId}]]';  // customizingId 값을 가져옵니다
    console.log("customizingId:", customizingId);  // 콘솔에 출력하여 값 확인
    let selectedEmojiId = '[[${customizingSetting.emojiId}]]'; // 기본값 설정



    // 이모지 선택 시 호출되는 함수
    function selectEmoji(emojiId) {
        selectedEmojiId = emojiId;
        document.getElementById('selected-icon').src = `/images/emojis/${emojiId}.png`;
    }

    // 색상 선택 시 호출되는 함수
    function selectColor(color) {
        selectedColor = color;
    }

    // 폼 데이터 제출 함수
    function submitForm() {
        const message = document.getElementById('message').value;
        const fileInput = document.getElementById('file');
        const file = fileInput.files[0];  // 파일이 선택되지 않으면 undefined 또는 null이 됩니다.

        const formData = new FormData();
        formData.append("customizingId", customizingId);
        formData.append("emojiId", selectedEmojiId);
        formData.append("message", message);


        // 파일이 선택되었을 경우에만 formData에 파일 추가
        if (file) {
            formData.append("image", file);
        }

        // 데이터 전송
        fetch('/message_cm/upload', {
            method: 'POST',
            body: formData
        })
            .then(response => response.text())
            .then(data => {
                alert("세팅이 변경되었습니다.");
                window.location.href = '/message_main';  // 수정 후 message_main으로 리다이렉트
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
</script>

</body>
</html>